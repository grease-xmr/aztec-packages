use crate::{
    address::{AztecAddress, PartialAddress, SaltedInitializationHash},
    contract_class_id::ContractClassId,
    hash::private_functions_root_from_siblings,
    public_keys::PublicKeys,
    tests::fixtures::contract_functions::get_protocol_contract_function,
};

pub struct ContractData {
    pub address: AztecAddress,
    pub artifact_hash: Field,
    pub contract_address_salt: Field,
    pub contract_class_id: ContractClassId,
    pub private_functions_root: Field,
    pub public_bytecode_commitment: Field,
    pub public_keys: PublicKeys,
    pub salted_initialization_hash: SaltedInitializationHash,
    pub partial_address: PartialAddress,
    pub deployer: AztecAddress,
}

// The following was generated by `noir_test_gen.test.ts`.
// Run the test with AZTEC_GENERATE_TEST_DATA=1 flag to update it.
pub global default_contract: ContractData = ContractData {
    contract_address_salt: 0x000000000000000000000000000000000000000000000000000000000000ddd5,
    artifact_hash: 0x0000000000000000000000000000000000000000000000000000000000003039,
    public_bytecode_commitment: 0x02b7e5d00c7db713d9bbca97fb00109acf3a5d6c017b61fe3760ef35a72c88ae,
    private_functions_root: 0x1f5723197ad3493936f2a95d7ec2095e54f3e1e74aeb3b71ef1e4af52be749ea,
    address: AztecAddress {
        inner: 0x00204a62efe98dfab19d055c36323311c718a36768d17a11b73d7d1da3cfc611,
    },
    partial_address: PartialAddress {
        inner: 0x277ef3900caa8c16c8b09af381a153b1090b8dcd05ca8d11381bd556d3dff83f,
    },
    contract_class_id: ContractClassId {
        inner: 0x05f9427d40b11ea829d365a3dfa6470529d8767611d2499f226aff85a2275ceb,
    },
    public_keys: PublicKeys::default(),
    salted_initialization_hash: SaltedInitializationHash {
        inner: 0x13a939daa511233e5446905ed2cadbee14948fa75df183b53b5c14b612bffe88,
    },
    deployer: AztecAddress {
        inner: 0x0000000000000000000000000000000000000000000000000000000000000000,
    },
};

// The following was generated by `noir_test_gen.test.ts`.
// Run the test with AZTEC_GENERATE_TEST_DATA=1 flag to update it.
pub global parent_contract: ContractData = ContractData {
    contract_address_salt: 0x0000000000000000000000000000000000000000000000000000000000001618,
    artifact_hash: 0x00000000000000000000000000000000000000000000000000000000000004bc,
    public_bytecode_commitment: 0x1fa970012bd11a88985f21a34cf26a285e696af1986c6348c6c46aedc6cc890b,
    private_functions_root: 0x164ec839e154a97418997f29881d8bf2efafa5ea0a03d16ed576694a85150e61,
    address: AztecAddress {
        inner: 0x1c39b2e8dd895a050e47e2acc00852475d9786ed38ce28d9b625db01f9595971,
    },
    partial_address: PartialAddress {
        inner: 0x0c4c2173b41718780243a3160059661269c6c0fe86020e2e80338dbb2458f92b,
    },
    contract_class_id: ContractClassId {
        inner: 0x27a7371f6abbef7894bbe0b8b09bb2f1a329ff651b28fb604f083dd3ff01c193,
    },
    public_keys: PublicKeys::default(),
    salted_initialization_hash: SaltedInitializationHash {
        inner: 0x24bd6ac7a182e2cf25e437c72f53544ef81dfd97d9afee23abb07a638e7be749,
    },
    deployer: AztecAddress {
        inner: 0x0000000000000000000000000000000000000000000000000000000000000000,
    },
};

pub fn get_protocol_contract(index: u32) -> ContractData {
    let seed = index as Field;
    let artifact_hash = 576576 + seed;
    let salted_initialization_hash = SaltedInitializationHash { inner: 281972 + seed };
    let public_bytecode_commitment = 38383 + seed;
    // Empty public keys here will throw an error when doing ec ops
    let public_keys = PublicKeys::default();

    let function = get_protocol_contract_function(index);
    let private_functions_root = private_functions_root_from_siblings(
        function.data.selector,
        function.vk_hash,
        function.membership_witness.leaf_index,
        function.membership_witness.sibling_path,
    );

    let contract_class_id = ContractClassId::compute(
        artifact_hash,
        private_functions_root,
        public_bytecode_commitment,
    );

    let partial_address = PartialAddress::compute_from_salted_initialization_hash(
        contract_class_id,
        salted_initialization_hash,
    );

    let address = AztecAddress::compute(public_keys, partial_address);

    ContractData {
        contract_address_salt: 1,
        artifact_hash,
        public_bytecode_commitment,
        private_functions_root,
        address,
        partial_address,
        contract_class_id,
        public_keys,
        salted_initialization_hash,
        deployer: AztecAddress { inner: 0 },
    }
}
